/*!
 * Realtime Cloud Storage JavaScript Library
 *
 * Copyright 2013, IBT, SA
 *
 * The Realtime Framework Storage Service is a 
 * highly-scalable nosql database based on AWS's 
 * DynamoDB. We've added realtime notifications 
 * to keep your data synchronized between users.
 * Building collaborative applications has never been easier.
 *
 * http://framework.realtime.co/storage
 *
 * Date: Thu Sep 19 2013 v1.0.0
 */
(function(h){(function(h){h.series=function(c,a){a||(a=function(){});if(c.length===0)return a();var d=0,b=[],k=function(){c[d](function(g){b[d]=g;++d==c.length?a&&a.apply(b,b):k()})};k()};h.parallel=function(c,a){a||(a=function(){});if(c.length===0)return a();var d=0,b=0,k=[],g=function(){c[d](function(d){return function(g){k[d]=g;++b==c.length&&a&&a.apply(k,k)}}(d));++d!=c.length&&g()};g()};var f=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};h.guidGenerator=function(){return f()+
f()+"-"+f()+"-"+f()+"-"+f()+"-"+f()+f()+f()};h.idGenerator=function(){return f()+f()};h.proxy=function(c,a){if(typeof c==="function"&&typeof a==="object")return function(){return c.apply(a,arguments)}};h.parse=function(c){if(typeof c=="function")return c;if(typeof c!="string")return null;var a="",d="return "+c+"(";if(arguments.length!=1){for(var b=1;b<arguments.length;++b)a+=arguments[b]+",";a=a.substring(0,a.length-1)}d+=a+");";return new window.Function(a,d)};h.loadScript=function(c,a){var d=document.createElement("script");
d.type="text/javascript";d.readyState?d.onreadystatechange=function(){if(d.readyState=="loaded"||d.readyState=="complete")d.onreadystatechange=null,a.apply(this,arguments)}:d.onload=function(){a.apply(this,arguments)};d.src=c;document.getElementsByTagName("head").length!=0?document.getElementsByTagName("head")[0].appendChild(d):document.body.appendChild(d)};h.keys=window.Object.keys||function(c){var a=[],d;for(d in c)window.Object.prototype.hasOwnProperty.call(c,d)&&a.push(d);return a};h.isArray=
window.Array.isArray||function(c){return Object.prototype.toString.call(c)==="[object Array]"}})(h.Util=h.Util||{})})(window.Realtime=window.Realtime||{});
(function(h){(function(e,f){var c=function(){var a={},d={};this.bind=function(b){for(var d in b)typeof b[d]==="function"&&(a[d]||(a[d]=[]),a[d].push(b[d]))};this.once=function(b){for(var a in b)typeof b[a]==="function"&&(d[a]||(d[a]=[]),d[a].push(b[a]))};this.unbind=function(b){for(var k in b){if(Object.prototype.toString.call(a[k])==="[object Array]")for(var g=0,c=a[k].length;g<c;g++)if(a[k][g]===b[k]){a[k].splice(g,1);break}if(Object.prototype.toString.call(d[k])==="[object Array]"){g=0;for(c=d[k].length;g<
c;g++)if(d[k][g]===b[k]){d[k].splice(g,1);break}}}};this.unbindAll=function(b){b||(delete a,a={},delete d,d={});b&&(a[b]=f,d[b]=f)};this.fire=function(b){var k,g;for(g in b){k={};for(var c in b[g])k[c]=b[g][c];var f=[];if(Object.prototype.toString.call(a[g])==="[object Array]")for(var l=0;l<a[g].length;l++)f.push(function(b,i){return function(a){i.call(b,k);a()}}(this,a[g][l]));if(Object.prototype.toString.call(d[g])==="[object Array]"){do if(l=d[g].shift())l=function(b,i){return function(a){i.call(b,
k);a()}}(this,l),f.push(l);while(d[g].length>0)}h.Util.parallel(f)}};this.listeners=function(b){var c=[];Object.prototype.toString.call(a[b])==="[object Array]"&&(c=c.concat(a[b]));Object.prototype.toString.call(d[b])==="[object Array]"&&(c=c.concat(d[b]));return c}};e.extend=function(a){var d=new c,b;for(b in d)a[b]=d[b]}})(h.Event=h.Event||{})})(window.Realtime=window.Realtime||{});
(function(h){(function(e){h.Event.extend(e);e.isReady=!1;e.ready=function(f){!e.isReady?e.bind({ready:f}):f()}})(window.Realtime.Messaging=window.Realtime.Messaging||{})})(window.Realtime=window.Realtime||{});
(function(h){(function(h,f){(function(){function c(b){return b<10?"0"+b:b}function a(b){k.lastIndex=0;return k.test(b)?'"'+b.replace(k,function(i){var b=n[i];return typeof b==="string"?b:"\\u"+("0000"+i.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+b+'"'}function d(b,i){var p,j,c,h,k=g,f,e=i[b];e&&typeof e==="object"&&typeof e.toJSON==="function"&&(e=e.toJSON(b));typeof l==="function"&&(e=l.call(i,b,e));switch(typeof e){case "string":return a(e);case "number":return isFinite(e)?String(e):"null";
case "boolean":case "null":return String(e);case "object":if(!e)return"null";g+=m;f=[];if(Object.prototype.toString.apply(e)==="[object Array]"){h=e.length;for(p=0;p<h;p+=1)f[p]=d(p,e)||"null";c=f.length===0?"[]":g?"[\n"+g+f.join(",\n"+g)+"\n"+k+"]":"["+f.join(",")+"]";g=k;return c}if(l&&typeof l==="object"){h=l.length;for(p=0;p<h;p+=1)j=l[p],typeof j==="string"&&(c=d(j,e))&&f.push(a(j)+(g?": ":":")+c)}else for(j in e)Object.hasOwnProperty.call(e,j)&&(c=d(j,e))&&f.push(a(j)+(g?": ":":")+c);c=f.length===
0?"{}":g?"{\n"+g+f.join(",\n"+g)+"\n"+k+"}":"{"+f.join(",")+"}";g=k;return c}}if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+c(this.getUTCMonth()+1)+"-"+c(this.getUTCDate())+"T"+c(this.getUTCHours())+":"+c(this.getUTCMinutes())+":"+c(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
k=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g,m,n={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},l;if(typeof h.stringify!=="function")h.stringify=function(b,i,a){var j;m=g="";if(typeof a==="number")for(j=0;j<a;j+=1)m+=" ";else typeof a==="string"&&(m=a);if((l=i)&&typeof i!=="function"&&(typeof i!=="object"||typeof i.length!=="number"))throw Error("JSON.stringify");return d("",{"":b})};
if(typeof h.parse!=="function")h.parse=function(a,i){function d(b,a){var j,g,l=b[a];if(l&&typeof l==="object")for(j in l)Object.hasOwnProperty.call(l,j)&&(g=d(l,j),g!==f?l[j]=g:delete l[j]);return i.call(b,a,l)}var j,a=String(a);b.lastIndex=0;b.test(a)&&(a=a.replace(b,function(i){return"\\u"+("0000"+i.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,
"")))return j=eval("("+a+")"),typeof i==="function"?d({"":j},""):j;throw new SyntaxError("JSON.parse");}})()})(h.JSON=h.JSON||{})})(window.Realtime=window.Realtime||{});
(function(h){(function(e){e.Connection=function(f){var c=null,a=!0;h.Event.extend(this);this.internalId=h.Util.guidGenerator();this.id=f.id||this.internalId;this.appKey=f.appKey;this.authToken=f.authToken;this.sendRetries=parseInt(f.sendRetries,10)||5;this.sendInterval=parseInt(f.sendInterval,10)||1E3;this.timeout=parseInt(f.timeout,10)||1E4;this.connectAttempts=parseInt(f.connectAttempts,10)||5;this.connectionAttemptsCounter=0;this.autoConnect=typeof f.autoConnect=="boolean"?f.autoConnect:!0;this.metadata=
f.metadata;this.serverType=f.serverType||"IbtRealTimeSJ";this.url=f.url;this.isCluster=typeof f.isCluster=="boolean"?f.isCluster:!0;this.announcementSubChannel=f.announcementSubChannel;this.channels={};var d=h.Util.proxy,b=h.Util.parse;this.messageAdapter=b(f.messageAdapter,"message");this.bind({create:b(f.onCreate,"e"),connect:b(f.onConnect,"e"),channelCreate:b(f.onChannelCreate,"e"),disconnect:b(f.onDisconnect,"e"),subscribe:b(f.onSubscribe,"e"),unsubscribe:b(f.onUnsubscribe,"e"),exception:b(f.onException,
"e"),reconnect:b(f.onReconnect,"e"),reconnecting:b(f.onReconnecting,"e"),message:b(f.onMessage,"e"),dispose:b(f.onDispose,"e")});var k=d(function(b,a,i){this.process({channel:a,message:i})},this),g=function(b){c=b.createClient();c.setId(this.internalId);c.setConnectionTimeout(this.timeout);c.setConnectionMetadata(typeof this.metadata=="object"?h.JSON.stringify(this.metadata):this.metadata);c.setAnnouncementSubChannel(this.announcementSubChannel);!this.isCluster?c.setUrl(this.url):c.setClusterUrl(this.url);
c.onConnected=d(function(b){for(var i in this.channels){var a=this.channels[i];a.subscribe&&b.subscribe(a.name,a.subscribeOnReconnect,k)}this.fire({connect:{}})},this);c.onDisconnected=d(function(){this.fire({disconnect:{}})},this);c.onSubscribed=d(function(b,i){this.channels[i].fire({subscribe:{}});this.fire({subscribe:{channel:i}})},this);c.onUnsubscribed=d(function(b,i){var a=this.channels[i];delete this.channels[i];a.fire({unsubscribe:{}});this.fire({unsubscribe:{channel:i}})},this);c.onException=
d(function(b,i){this.fire({exception:{message:i}})},this);c.onReconnected=d(function(){this.connectionAttemptsCounter=0;this.fire({reconnect:{}})},this);c.onReconnecting=d(function(b){this.connectionAttemptsCounter>=this.connectAttempts?b.disconnect():(this.connectionAttemptsCounter++,this.fire({reconnecting:{}}))},this);this.fire({create:{}});this.autoConnect&&c.connect(this.appKey,this.authToken)},m=function(b,a){this.isCreated()&&this.isConnected()?this.send(b):++a<=this.sendRetries&&setTimeout(d(function(){d(m,
this)(b,a)},this),this.sendInterval)};this.active=function(b){typeof b=="boolean"&&(a=b);return a};this.dispose=function(){this.isConnected()&&this.disconnect();this.fire({dispose:{}})};this.createChannel=function(a){if(!a)return this.fire({exception:{message:"No channel to create."}}),null;if(this.channels[a.name])return this.channels[a.name];var d={name:a.name,subscribeOnReconnect:typeof a.subscribeOnReconnect=="boolean"?a.subscribeOnReconnect:!0,subscribe:typeof a.subscribe=="boolean"?a.subscribe:
!0,messageAdapter:b(a.messageAdapter,"message")};h.Event.extend(d);d.bind({message:b(a.onMessage,"e"),subscribe:b(a.onSubscribe,"e"),unsubscribe:b(a.onUnsubscribe,"e")});this.channels[a.name]=d;this.fire({channelCreate:{channel:d}});return d};this.process=function(b){var a=b.channel,i=b.message;if(i.substring(0,15)=="_X_SEND_ONLY_X_"){if(this.internalId==i.substring(15,51))return;i=i.substring(54)}this.active()&&(h.Util.series([h.Util.proxy(function(b){this.messageAdapter&&(i=this.messageAdapter(i));
b()},this),h.Util.proxy(function(b){this.fire({message:{channel:a,message:i}});b()},this)]),this.channels[a]&&h.Util.series([h.Util.proxy(function(b){this.channels[a].messageAdapter&&(i=this.channels[a].messageAdapter(i));b()},this),h.Util.proxy(function(b){this.channels[a].fire({message:{message:i}});b()},this)]))};this.send=function(b){var a=b.channel,i=b.content;this.isCreated()&&this.isConnected()?this.active()&&(i=typeof i==="object"?h.JSON.stringify(i):i,b.sendOnly&&(i="_X_SEND_ONLY_X_"+this.internalId+
"_X_"+i),c.send(a,i)):setTimeout(d(function(){d(m,this)(b,0)},this),this.sendInterval)};this.connect=function(b){if(this.isCreated()){if(b)this.appKey=b.appKey,this.authToken=b.authToken;c.connect(this.appKey,this.authToken)}};this.disconnect=function(){this.isConnected()?c.disconnect():this.fire({exception:{message:"Already disconnected."}})};this.subscribe=function(b){this.channels[b.name]||(b=this.createChannel(b));c.subscribe(this.channels[b.name].name,this.channels[b.name].subscribeOnReconnect,
k)};this.unsubscribe=function(b){c.unsubscribe(b)};this.isCreated=function(){return c!=null};this.isConnected=function(){return this.isCreated()?c.getIsConnected():!1};this.isSubscribed=function(b){return this.isConnected()?c.isSubscribed(b):!1};this.getMetadata=function(){if(this.isCreated())try{return h.JSON.parse(c.getConnectionMetadata())}catch(b){return c.getConnectionMetadata()}return null};this.setMetadata=function(b){if(this.isCreated())c.setConnectionMetadata(typeof b=="object"?h.JSON.stringify(b):
b),this.metadata=b};this.getAnnouncementSubChannel=function(){return this.isCreated()?c.getAnnouncementSubChannel():null};this.getProtocol=function(){return this.isConnected()?c.getProtocol():null};this.setProtocol=function(b){this.isCreated()&&c.setProtocol(b)};window.loadOrtcFactory?loadOrtcFactory(this.serverType,d(g,this)):h.Messaging.ready(d(function(){d(loadOrtcFactory,this)(this.serverType,d(g,this))},this));if(f.channels&&Object.prototype.toString.call(f.channels)==="[object Array]")for(var f=
f.channels,e=0;e<f.length;++e)this.createChannel(f[e])}})(h.Messaging=h.Messaging||{})})(window.Realtime=window.Realtime||{});
(function(h){(function(){(function(e,f){h.Event.extend(e);e.Connections=[];var c={},a={add:function(a){var b=a.connection.id;this.bConnections[b]||(this.bConnections[b]=[],a.connection.bind({connect:this.send}));this.bConnections[b].push(a.message)},bConnections:{},send:function(){for(var d=a.bConnections[this.id],b=0;b<d.length;++b)this.send(d[b]);this.unbind({connect:a.send});a.bConnections[this.id]=f}};e.create=function(a){return this.add(new h.Messaging.Connection(a))};e.add=function(a){if(this.getById(a.id))return null;
this.Connections.push(a.id);c[a.internalId]=a;this.fire({create:{connection:a}});a.bind({message:function(b){e.fire({message:{connection:this,channel:b.channel,message:b.message}})}});a.bind({dispose:function(){var b=this.internalId;c[b]=null;delete c[b];for(var b=0,a=e.Connections,d=a.length;b<d;b++)if(a[b]===this.id){a.splice(b,1);break}e.fire({dispose:{connection:this}})}});return a};e.getById=function(a){var b;if(!(b=c[a]))a:{for(var h in c)if(c[h].id===a){b=c[h];break a}b=f}return b};e.dispose=
function(a){(a=this.getById(a))&&a.dispose();return!!a};e.addChannel=function(a){var b=this.getById(a.connectionId);b&&b.createChannel(a);return!!b};e.sendMessage=function(d){for(var b,c=0;c<d.connections.length;++c)(b=this.getById(d.connections[c]))&&(b.isConnected()?b.send(d):a.add({connection:b,message:{channel:d.channel,content:d.content,sendOnly:d.sendOnly}}))}})(h.Messaging.ConnectionManager=h.Messaging.ConnectionManager||{})})(h.Messaging=h.Messaging||{})})(window.Realtime=window.Realtime||
{});
(function(h){(function(){(function(e){e.active=!1;var f=function(){return typeof console!=="undefined"?console:{log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){}}}();h.Messaging.ConnectionManager.bind({create:function(c){c.connection.bind({create:function(){e.active&&f.log("Connection "+this.id+" created. "+(this.autoConnect?"Connecting...":"Waiting for explicit connect..."))},connect:function(){if(e.active){var a="Connection "+this.id+" established. Using "+this.getProtocol()+
" protocol.";f.log(a)}},disconnect:function(){e.active&&f.log("Connection "+this.id+" closed.")},subscribe:function(a){e.active&&f.log("Connection "+this.id+": Channel "+a.channel+" subscribed.")},unsubscribe:function(a){e.active&&f.log("Connection "+this.id+": Channel "+a.channel+" unsubscribed.")},exception:function(a){e.active&&f.log("Connection "+this.id+" threw an exception: "+a.message)},reconnect:function(){if(e.active){var a="Connection "+this.id+" is restored. Using "+this.getProtocol()+
" protocol.";f.log(a)}},reconnecting:function(){if(e.active){var a="Connection "+this.id+" was lost. ";a+=this.connectionAttemptsCounter>=this.connectAttempts?"Maximum number of attempts reached: "+this.connectAttempts+" Stop trying to reconnect.":"Trying to reconnect. Attempt "+this.connectionAttemptsCounter+" out of "+this.connectAttempts;f.log(a)}},message:function(a){if(e.active){var d="Connection "+this.id+": Message received from channel "+a.channel,b;try{b=h.JSON.parse(a.message)}catch(c){b=
a.message}f.log(d);f.log(b)}}})}})})(h.Messaging.TraceMonitor=h.Messaging.TraceMonitor||{})})(h.Messaging=h.Messaging||{})})(window.Realtime=window.Realtime||{});
(function(h){var e=function(){h.Messaging.isReady=!0;h.Messaging.fire({ready:{}})};typeof loadOrtcFactory=="undefined"?h.Util.loadScript(document.location.protocol=="file:"?"http://dfdbz2tdq3k01.cloudfront.net/js/2.1.0/ortc.js":document.location.protocol+"//dfdbz2tdq3k01.cloudfront.net/js/2.1.0/ortc.js",e):e()})(window.Realtime=window.Realtime||{});
(function(h){(function(e,f){var c=new function(){var b=this;h.Event.extend(this);for(var a=function(){var b=this,a=!1;this.work=function(j){if(!a){var g=j.get();if(g){a=!0;var c={method:g.item.method,url:g.item.url,data:g.item.parameters,headers:g.item.headers,crossDomain:g.item.crossDomain,success:function(b){typeof g.item.success=="function"&&g.item.success(b)},error:function(b){typeof g.item.error=="function"&&g.item.error(b)},complete:function(d){typeof g.item.complete=="function"&&g.item.complete(d);
a=!1;b.work(j)}};g.item.path&&(c.url+=g.item.path);d(c)}}}},c=[],l=0;l<6;l++){var k=new a;this.bind({item:function(){k.work(b)}})}this.set=function(b){c.push({item:b});this.fire({item:this})};this.get=function(){return c.length>0?c.shift():f}},a=function(a){if(typeof window.ArrayBuffer!="undefined"&&window.XMLHttpRequest)return b();if(a){if(window.XDomainRequest)return k()}else if(window.XMLHttpRequest)return b()},d=function(b){var d=a(b.crossDomain);d&&(d.create({method:b.method,url:b.url,callback:function(a,
d){var c={error:null,data:null};if(typeof d!="undefined"&&d!=null){if(b.error)c.error=d,b.error(c)}else if(b.success){try{c=h.JSON.parse(a)}catch(i){c=a}b.success(c)}b.complete&&b.complete(c)},headers:b.headers}),b.data?d.send(b.data):d.send())},b=function(){return{create:function(b){var a=this;this.xhr=new window.XMLHttpRequest;this.callback=b.callback;this.xhr.onreadystatechange=function(){a.xhr.readyState==4&&(a.xhr.status==200?a.callback(a.xhr.responseText,null,a.xhr.status):a.xhr.status==0?a.callback(null,
"The status code is 0 which likely means that the server is unavailable.",a.xhr.status):a.callback(a.xhr.responseText))};b.url=b.url+"?ts="+ +new Date;this.xhr.open(b.method,b.url,!0);if(b.headers)for(var d in b.headers)this.xhr.setRequestHeader(d,b.headers[d]);else b.method!="GET"&&(this.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8"),this.xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"));return this},send:function(b){b&&typeof b!="string"?(b=h.JSON.stringify(b),
this.xhr.send(b)):this.xhr.send()}}},k=function(){return{create:function(b){var a=this;this.xdr=new window.XDomainRequest;this.callback=b.callback;this.xdr.onload=function(){a.callback(a.xdr.responseText)};this.xdr.onerror=this.xdr.ontimeout=function(){a.callback(null,a.xdr.responseText&&a.xdr.responseText!=""?a.xdr.responseText:"Cannot complete the request.",500)};b.url=b.url+"?ts="+ +new Date;this.xdr.open(b.method,b.url,!0);if(b.method!="GET")try{this.xdr.contentType="text/plain"}catch(d){}return this},
send:function(b){var a=this;b&&typeof b!="string"?(b=h.JSON.stringify(b),setTimeout(function(){a.xdr.send(b)},200)):setTimeout(function(){a.xdr.send()},200)}}};e.post=function(b){b.method="POST";c.set(b)};e.get=function(b){b.method="GET";if(typeof b.data!="undefined"){var a=b.url,d=b.data;a+=a.indexOf("?")==-1?"?":"&";for(var f in b.data){var h=d[f];typeof h!="object"&&typeof h!="boolean"&&(a+=f+"="+h+"&")}a.lastIndexOf("&")==a.length-1&&(a=a.slice(0,-1));b.url=a}c.set(b)}})(window.Realtime.Request=
window.Realtime.Request||{})})(window.Realtime=window.Realtime||{});
(function(h){(function(e){var f={"Content-Type":"application/json; charset=utf-8"},c=function(a,d,b,c){a.error?c&&(!d&&typeof a.error=="string"&&a.error.match("unavailable")&&a.error.match("status")&&a.error.match("0")&&a.error.match("server")?c({error:a.error,retry:!0}):c({error:a.error,retry:!1})):b&&b(a.data)};e.Operation=function(a){this.credentials=a;this.setCredentials=function(a){a.applicationKey=this.credentials.applicationKey;a.authenticationToken=this.credentials.authenticationToken;return a}};
e.Operation.prototype={isAuthenticated:function(a,d,b,k){var g=this,a=this.setCredentials(a);this.credentials.getURL(function(e){h.Request.post({url:e,path:"/isAuthenticated",parameters:a,crossDomain:!0,headers:f,complete:function(f){c(f,k,d,function(c){c.retry?g.credentials.refreshURL(function(){g.isAuthenticated(a,d,b,!0)},b):b&&b(c.error.message)})}})},b)},listItems:function(a,d,b,k){var g=this,a=this.setCredentials(a);this.credentials.getURL(function(e){h.Request.post({url:e,path:"/listItems",
parameters:a,crossDomain:!0,headers:f,complete:function(f){c(f,k,d,function(c){c.retry?g.credentials.refreshURL(function(){g.listItems(a,d,b,!0)},b):b&&b(c.error.message)})}})},b)},queryItems:function(a,d,b,k){var g=this,a=this.setCredentials(a);this.credentials.getURL(function(e){h.Request.post({url:e,path:"/queryItems",parameters:a,crossDomain:!0,headers:f,complete:function(f){c(f,k,d,function(c){c.retry?g.credentials.refreshURL(function(){g.queryItems(a,d,b,!0)},b):b&&b(c.error.message)})}})},
b)},getItem:function(a,d,b,k){var g=this,a=this.setCredentials(a);this.credentials.getURL(function(e){h.Request.post({url:e,path:"/getItem",parameters:a,crossDomain:!0,headers:f,complete:function(f){c(f,k,d,function(c){c.retry?g.credentials.refreshURL(function(){g.getItem(a,d,b,!0)},b):b&&b(c.error.message)})}})},b)},putItem:function(a,d,b,k){var g=this,a=this.setCredentials(a);this.credentials.getURL(function(e){h.Request.post({url:e,path:"/putItem",parameters:a,crossDomain:!0,headers:f,complete:function(f){c(f,
k,d,function(c){c.retry?g.credentials.refreshURL(function(){g.putItem(a,d,b,!0)},b):b&&b(c.error.message)})}})},b)},updateItem:function(a,d,b,k){var g=this,a=this.setCredentials(a);this.credentials.getURL(function(e){h.Request.post({url:e,path:"/updateItem",parameters:a,crossDomain:!0,headers:f,complete:function(f){c(f,k,d,function(c){c.retry?g.credentials.refreshURL(function(){g.updateItem(a,d,b,!0)},b):b&&b(c.error.message)})}})},b)},deleteItem:function(a,d,b,k){var g=this,a=this.setCredentials(a);
this.credentials.getURL(function(e){h.Request.post({url:e,path:"/deleteItem",parameters:a,crossDomain:!0,headers:f,complete:function(f){c(f,k,d,function(c){c.retry?g.credentials.refreshURL(function(){g.deleteItem(a,d,b,!0)},b):b&&b(c.error.message)})}})},b)},createTable:function(a,d,b,e){var g=this,a=this.setCredentials(a);this.credentials.getURL(function(m){h.Request.post({url:m,path:"/createTable",parameters:a,crossDomain:!0,headers:f,complete:function(f){c(f,e,d,function(c){c.retry?g.credentials.refreshURL(function(){g.createTable(a,
d,b,!0)},b):b&&b(c.error.message)})}})},b)},updateTable:function(a,d,b,e){var g=this,a=this.setCredentials(a);this.credentials.getURL(function(m){h.Request.post({url:m,path:"/updateTable",parameters:a,crossDomain:!0,headers:f,complete:function(f){c(f,e,d,function(c){c.retry?g.credentials.refreshURL(function(){g.updateTable(a,d,b,!0)},b):b&&b(c.error.message)})}})},b)},deleteTable:function(a,d,b,e){var g=this,a=this.setCredentials(a);this.credentials.getURL(function(m){h.Request.post({url:m,path:"/deleteTable",
parameters:a,crossDomain:!0,headers:f,complete:function(f){c(f,e,d,function(c){c.retry?g.credentials.refreshURL(function(){g.deleteTable(a,d,b,!0)},b):b&&b(c.error.message)})}})},b)},listTables:function(a,d,b,e){var g=this,a=this.setCredentials(a);this.credentials.getURL(function(m){h.Request.post({url:m,path:"/listTables",parameters:a,crossDomain:!0,headers:f,complete:function(f){c(f,e,d,function(c){c.retry?g.credentials.refreshURL(function(){g.listTables(a,d,b,!0)},b):b&&b(c.error.message)})}})},
b)},describeTable:function(a,d,b,e){var g=this,a=this.setCredentials(a);this.credentials.getURL(function(m){h.Request.post({url:m,path:"/describeTable",parameters:a,crossDomain:!0,headers:f,complete:function(f){c(f,e,d,function(c){c.retry?g.credentials.refreshURL(function(){g.describeTable(a,d,b,!0)},b):b&&b(c.error.message)})}})},b)}}})(window.Realtime.Storage=window.Realtime.Storage||{})})(window.Realtime=window.Realtime||{});
(function(h){(function(e){e.ItemSnapshot=function(f){var c=f.credentials,a=f.table,d=f.connection,b=f.operationManager,e=f.value;this.ref=function(){return new h.Storage.ItemRef({properties:e,table:a,credentials:c,connection:d,operationManager:b})};this.val=function(){return e}}})(window.Realtime.Storage=window.Realtime.Storage||{})})(window.Realtime=window.Realtime||{});
(function(h){(function(e,f){e.ItemRef=function(c){var a=this,d=c.credentials,b=c.table,e=c.connection,g=c.operationManager,m=c.key;m||b.meta(function(b){m={primary:c.properties[b.key.primary.name],secondary:b.key.secondary?c.properties[b.key.secondary.name]:f}});var n=function(a,c){var i={},f={put:function(b){b=h.JSON.parse(b.message);g({operation:"put",message:b})},update:function(b){b=h.JSON.parse(b.message);g({operation:"update",message:b})},"delete":function(b){b=h.JSON.parse(b.message);g({operation:"delete",
message:b})}},j={};h.Event.extend(j);var g=function(a){var i={};i[a.operation]=new h.Storage.ItemSnapshot({table:b,credentials:d,connection:e,value:a.message});j.fire(i)};return{subscribe:function(b,d,g,h){var e="rtcs_"+c+"_"+b;d&&(e+=":"+d.primary,typeof d.secondary!="undefined"&&(e+="_"+d.secondary));if(i[e])if(k={},k[b]=h,g)j.once(k);else j.bind(k);else{d=f[b];a.isConnected()?a.subscribe({name:e}):a.createChannel({name:e});i[e]=!0;var k={};k[b]=h;g?(a.channels[e].once({message:d}),j.once(k)):(a.channels[e].bind({message:d}),
j.bind(k))}},unsubscribe:function(b,a,i){b?typeof i!="function"?j.unbindAll(b):(a={},a[b]=i,j.unbind(a)):j.unbindAll()}}}(e,b.name());this.get=function(c,f){b.meta(function(i){var p=null;if(typeof m.primary!=i.key.primary.dataType)return f&&f("The primary key specified does not match the table schema."),a;if(i.key.secondary){if(!m.secondary)return f&&f("Missing secondary key. Must be specified when creating an ItemRef."),a;if(typeof m.secondary!=i.key.secondary.dataType)return f&&f("The secondary key specified does not match the table schema."),
a}g.getItem({table:b.name(),key:m},function(a){c&&(h.Util.keys(a)==0?c(null):c(new h.Storage.ItemSnapshot({key:m,table:b,credentials:d,connection:e,value:a,operationManager:g})))},f)});return this};this.set=function(c,f,i){b.meta(function(p){var j=null;if(typeof m.primary!=p.key.primary.dataType)return i&&i("The primary key specified does not match the table schema."),a;if(p.key.secondary){if(!m.secondary)return i&&i("Missing secondary key. Must be specified when creating an ItemRef."),a;if(typeof m.secondary!=
p.key.secondary.dataType)return i&&i("The secondary key specified does not match the table schema."),a}if(h.Util.keys(c).length==0)return i&&i("No properties to update"),a;g.updateItem({table:b.name(),key:m,item:c},function(a){f&&f(new h.Storage.ItemSnapshot({key:m,table:b,credentials:d,connection:e,value:a,operationManager:g}))},i)});return this};this.del=function(){var c,f,i;arguments.length==3&&(c=arguments[0],f=arguments[1],i=arguments[2]);arguments.length==2&&(typeof arguments[0]=="function"&&
typeof arguments[1]=="function"?(f=arguments[0],i=arguments[1]):typeof arguments[1]=="function"&&(c=arguments[0],f=arguments[1]));arguments.length==1&&(typeof arguments[0]!="function"?c=arguments[0]:f=arguments[0]);b.meta(function(p){var j=null;if(typeof m.primary!=p.key.primary.dataType)return i&&i("The primary key specified does not match the table schema."),a;if(p.key.secondary){if(!m.secondary)return i&&i("Missing secondary key. Must be specified when creating an ItemRef."),a;if(typeof m.secondary!=
p.key.secondary.dataType)return i&&i("The secondary key specified does not match the table schema."),a}p={table:b.name(),key:m};if(h.Util.isArray(c)&&c.length>0){for(j=0;j<c.length;j++)if(typeof c[j]!="string")return j="Invalid property names. Must be strings",i&&i(j),a;p.properties=c}g.deleteItem(p,function(a){f&&f(new h.Storage.ItemSnapshot({table:b,credentials:d,connection:e,value:a,operationManager:g}))},i)});return this};this.on=function(a,c,i){if(!a)return i&&i("Must specify an event type"),
this;if(a!="put"&&a!="delete"&&a!="update")return i&&i("Invalid event type. Possible values: put, delete and update"),this;if(typeof c!="function")return i&&i("Must specify the handler to the event"),this;m?n.subscribe(a,m,!1,c):b.meta(function(){n.subscribe(a,m,!1,c)});a=="put"&&this.get(function(b){c(b)});return this};this.off=function(b,a,i){if(b&&b!="put"&&b!="delete"&&b!="update")return i&&i("Invalid event type. Possible values: put, delete and update"),this;n.unsubscribe(b,m,a);return this};
this.once=function(a,c,i){if(!a)return i&&i("Must specify an event type"),this;if(a!="put"&&a!="delete"&&a!="update")return i&&i("Invalid event type. Possible values: put, delete and update"),this;if(typeof c!="function")return i&&i("Must specify the handler to the event"),this;a=="put"?this.get(function(b){c(b)}):m?n.subscribe(a,m,!0,c):b.meta(function(){n.subscribe(a,m,!0,c)});return this}}})(window.Realtime.Storage=window.Realtime.Storage||{})})(window.Realtime=window.Realtime||{});
(function(h){(function(e){e.TableSnapshot=function(f){var c=f.credentials,a=f.connection,d=f.operationManager,b=f.name;this.ref=function(){return new h.Storage.TableRef({name:b,credentials:c,connection:a,operationManager:d})};this.val=function(){return b}}})(window.Realtime.Storage=window.Realtime.Storage||{})})(window.Realtime=window.Realtime||{});
(function(h){(function(e,f){e.TableRef=function(c){var a=this;h.Event.extend(this);var d=c.credentials,b=c.connection,k=c.operationManager,g={name:c.name||c.properties.name,limit:c.properties?c.properties.limit:0,searchForward:c.properties?c.properties.searchForward:!0,filter:c.properties?c.properties.filter:[]},m=function(i,c){var j={},f={put:function(b){b=h.JSON.parse(b.message);e({operation:"put",message:b})},update:function(b){b=h.JSON.parse(b.message);e({operation:"update",message:b})},"delete":function(b){b=
h.JSON.parse(b.message);e({operation:"delete",message:b})}},g={};h.Event.extend(g);var e=function(i){a.meta(function(c){var j={primary:i.message[c.key.primary.name]};if(c.key.secondary)j.secondary=i.message[c.key.secondary.name];c={};c[i.operation]=new h.Storage.ItemSnapshot({key:j,table:a,credentials:d,connection:b,value:i.message});g.fire(c)})};return{subscribe:function(b,a,d,e){var h="rtcs_"+c+"_"+b;a&&(h+=":"+a.primary,typeof a.secondary!="undefined"&&(h+="_"+a.secondary));if(j[h])if(k={},k[b]=
e,d)g.once(k);else g.bind(k);else{a=f[b];i.isConnected()?i.subscribe({name:h}):i.createChannel({name:h});j[h]=!0;var k={};k[b]=e;d?(i.channels[h].once({message:a}),g.once(k)):(i.channels[h].bind({message:a}),g.bind(k))}},unsubscribe:function(b,a,i){b?typeof i!="function"?g.unbindAll(b):(a={},a[b]=i,g.unbind(a)):g.unbindAll()}}}(b,g.name),n=function(){var b={},a;for(a in g)b[a]=h.Util.isArray(g[a])?g[a].concat():g[a];return b};this.name=function(){return g.name};this.limit=function(a,c){if(typeof a!=
"number")return c&&c("The limit must be a number."),this;var j=n();j.limit=a>=0?a:j.limit;return new e.TableRef({properties:j,credentials:d,connection:b,operationManager:k})};this.asc=function(){var a=n();a.searchForward=!0;return new e.TableRef({properties:a,credentials:d,connection:b,operationManager:k})};this.desc=function(){var a=n();a.searchForward=!1;return new e.TableRef({properties:a,credentials:d,connection:b,operationManager:k})};this.notNull=function(a,c){if(typeof a.item=="string"){var j=
n();j.filter.push({operator:"notNull",item:a.item});return new e.TableRef({properties:j,credentials:d,connection:b,operationManager:k})}else return c&&c("Invalid filter. The property item must be defined and be a string."),this};this.isNull=function(a,c){if(typeof a.item=="string"){var j=n();j.filter.push({operator:"null",item:a.item});return new e.TableRef({properties:j,credentials:d,connection:b,operationManager:k})}else return c&&c("Invalid filter. The property item must be defined and be a string."),
this};this.equals=function(a,c){if(typeof a.item!="string")return c&&c("Invalid filter. The property item must be defined and be a string."),this;if(typeof a.value=="undefined")return c&&c("Invalid filter. The property value must be defined."),this;var j=n();j.filter.push({operator:"equals",item:a.item,value:a.value});return new e.TableRef({properties:j,credentials:d,connection:b,operationManager:k})};this.notEquals=function(a,c){if(typeof a.item!="string")return c&&c("Invalid filter. The property item must be defined and be a string."),
this;if(typeof a.value!="undefined")return c&&c("Invalid filter. The property value must be defined."),this;var j=n();j.filter.push({operator:"notEquals",item:a.item,value:a.value});return new e.TableRef({properties:j,credentials:d,connection:b,operationManager:k})};this.greaterEqual=function(a,c){if(typeof a.item!="string")return c&&c("Invalid filter. The property item must be defined and be a string."),this;if(typeof a.value=="undefined")return c&&c("Invalid filter. The property value must be defined."),
this;var j=n();j.filter.push({operator:"greaterEqual",item:a.item,value:a.value});return new e.TableRef({properties:j,credentials:d,connection:b,operationManager:k})};this.greaterThan=function(a,c){if(typeof a.item!="string")return c&&c("Invalid filter. The property item must be defined and be a string."),this;if(typeof a.value=="undefined")return c&&c("Invalid filter. The property value must be defined."),this;var j=n();j.filter.push({operator:"greaterThan",item:a.item,value:a.value});return new e.TableRef({properties:j,
credentials:d,connection:b,operationManager:k})};this.lesserEqual=function(a,c){if(typeof a.item!="string")return c&&c("Invalid filter. The property item must be defined and be a string."),this;if(typeof a.value=="undefined")return c&&c("Invalid filter. The property value must be defined."),this;var j=n();j.filter.push({operator:"lessEqual",item:a.item,value:a.value});return new e.TableRef({properties:j,credentials:d,connection:b,operationManager:k})};this.lesserThan=function(a,c){if(typeof a.item!=
"string")return c&&c("Invalid filter. The property item must be defined and be a string."),this;if(typeof a.value=="undefined")return c&&c("Invalid filter. The property value must be defined."),this;var j=n();j.filter.push({operator:"lessThan",item:a.item,value:a.value});return new e.TableRef({properties:j,credentials:d,connection:b,operationManager:k})};this.contains=function(a,c){if(typeof a.item!="string")return c&&c("Invalid filter. The property item must be defined and be a string."),this;if(typeof a.value==
"undefined")return c&&c("Invalid filter. The property value must be defined."),this;var j=n();j.filter.push({operator:"contains",item:a.item,value:a.value});return new e.TableRef({properties:j,credentials:d,connection:b,operationManager:k})};this.notContains=function(a,c){if(typeof a.item!="string")return c&&c("Invalid filter. The property item must be defined and be a string."),this;if(typeof a.value=="undefined")return c&&c("Invalid filter. The property value must be defined."),this;var j=n();j.filter.push({operator:"notContains",
item:a.item,value:a.value});return new e.TableRef({properties:j,credentials:d,connection:b,operationManager:k})};this.beginsWith=function(a,c){if(typeof a.item!="string")return c&&c("Invalid filter. The property item must be defined and be a string."),this;if(typeof a.value=="undefined")return c&&c("Invalid filter. The property value must be defined."),this;var j=n();j.filter.push({operator:"beginsWith",item:a.item,value:a.value});return new e.TableRef({properties:j,credentials:d,connection:b,operationManager:k})};
this.between=function(a,c){if(typeof a.item!="string")return c&&c("Invalid filter. The property item must be defined and be a string."),this;if(!h.Util.isArray(a.value)||a.value.length!=2)return c&&c("Invalid filter. The property value must be defined and must be an array (length 2) of numbers."),this;var j=n();j.filter.push({operator:"between",item:a.item,value:a.value});return new e.TableRef({properties:j,credentials:d,connection:b,operationManager:k})};this.meta=function(a,b){if(o)a&&a(o);else{var c=
function(){a&&a(o);this.unbind({meta:c})};this.bind({meta:c});this.bind({error:function(a){b&&b(a.message)}})}return this};this.del=function(a,b){k.deleteTable({table:this.name()},function(b){o=null;a&&a(b.data)},b);return this};this.push=function(c,f,j){if(typeof c!="object"||h.Util.keys(c).length==0)j&&j("Invalid item to push.");else{var e=null,m={table:g.name,item:c};this.meta(function(b){if(!c[b.key.primary.name])return e="The item specified does not contain the primary key property.",j&&j(e),
a;if(typeof c[b.key.primary.name]!=b.key.primary.dataType)return e="The data type of the primary key does not match the schema of the table.",j&&j(e),a;if(b.key.secondary){if(!c[b.key.secondary.name])return e="The item specified does not contain the secondary key property.",j&&j(e),a;if(typeof c[b.key.secondary.name]!=b.key.secondary.dataType)return e="The data type of the secondary key does not match the schema of the table.",j&&j(e),a}if(b.key.secondary){if(h.Util.keys(c).length<=2)return e="Cannot put an item that only contains key properties.",
j&&j(e),a}else if(h.Util.keys(c).length<=1)return e="Cannot put an item that only contains the key property.",j&&j(e),a},j);k.putItem(m,function(c){f&&f(new h.Storage.ItemSnapshot({table:a,credentials:d,connection:b,value:c,operationManager:k}))},j)}return this};this.create=function(a,b,c){var d=null;if(!a.provisionType)return c&&c("Missing provision type property. Must specify the provision type properties. The provision values must be between 1 and 5. Use the constants in the Storage.ProvisionType object"),
this;if(typeof a.provisionType!="number")return c&&c("Invalid provision. Must specify the provision type properties. The provision values must be between 1 and 5. Use the constants in the Storage.ProvisionType object"),this;if(!a.key)return c&&c("Missig argument key. The key schema must be specified"),this;if(typeof a.key.primary!="object")return c&&c("Missing primary key. The primary key property must be an object."),this;if(typeof a.key.primary.name=="undefined"||typeof a.key.primary.dataType==
"undefined")return c&&c("The primary key must contain a name and a data type (dataType) properties."),this;if(a.key.primary.dataType!="string"&&a.key.primary.dataType!="number")return c&&c('Invalid primary key dataType. Must be "number" or "string".'),this;d={table:g.name,provisionType:a.provisionType,key:{primary:a.key.primary}};if(a.key.secondary){if(typeof a.key.secondary!="object")return c&&c("The secondary key property must be an object."),this;if(typeof a.key.secondary.name=="undefined"||typeof a.key.secondary.dataType==
"undefined")return c&&c("The secondary key must contain a name and a data type (dataType) properties."),this;if(a.key.secondary.dataType!="string"&&a.key.secondary.dataType!="number")return c&&c('Invalid secondary key dataType. Must be "number" or "string".'),this;d.key.secondary=a.key.secondary}if(d.provisionType==5){if(typeof a.throughput!="object")return c&&c("Invalid throughput. For custom provision you must specify the throughput object with the read and write values. The values mean operations per second (ex: 2 reads per second and 3 writes per second)."),
this;if(typeof a.throughput.read!="number")return c&&c("Invalid read throughput. Must be a number"),this;if(typeof a.throughput.write!="number")return c&&c("Invalid write throughput. Must be a number"),this;d.throughput=a.throughput}else{if(!a.provisionLoad)return c&&c("Must specify the provision load property. The provision values must be between 1 and 3. Use the constants in the Storage.ProvisionLoads object"),this;if(typeof a.provisionLoad!="number")return c&&c("Invalid provision. Must specify the provision properties. The provision load value must be between 1 and 3. Use the constants in the Storage.ProvisionLoads object"),
this;d.provisionLoad=a.provisionLoad}k.createTable(d,b,c);return this};this.update=function(a,b,c){var d=null,d={table:g.name};if(!a.provisionType&&!a.provisionLoad)return c&&c("Nothing to update. Must specify a provision load or a provision type. Use the constants in the Storage.ProvisionType and Storage.ProvisionLoad objects"),this;if(a.provisionType){if(typeof a.provisionType!="number")return c&&c("Invalid provisionType property. The provision values must be between 1 and 5. Use the constants in the Storage.ProvisionType object"),
this;d.provisionType=a.provisionType}if(a.provisionLoad){if(typeof a.provisionLoad!="number")return c&&c("Invalid provisionLoad property. The provision values must be between 1 and 3. Use the constants in the Storage.ProvisionLoad object"),this;d.provisionLoad=a.provisionLoad}if(a.provisionType==5){if(typeof a.throughput!="object")return c&&c("Invalid throughput. For custom provision you must specify the throughput object with the read and write values. The values mean operations per second (ex: 2 reads per second and 3 writes per second)."),
this;if(typeof a.throughput.read!="number")return c&&c("Invalid read throughput. Must be a number"),this;if(typeof a.throughput.write!="number")return c&&c("Invalid write throughput. Must be a number"),this;d.throughput=a.throughput}k.updateTable(d,function(a){o=null;b&&b(a)},c);return this};this.item=function(a,c){if(typeof a!="object")return c&&c("Invalid key argument. Must be an object."),this;return!a.primary?(c&&c("Invalid key object. Primary key missing"),this):new h.Storage.ItemRef({key:a,
table:this,credentials:d,connection:b,operationManager:k})};var l=function(c,f){a.meta(function(e){var m,l={table:g.name};if(e.key.secondary&&g.filter.length==1){var n=g.filter[0];n.item==e.key.primary.name&&n.operator=="equals"?(l.key={primary:n.value},m="queryItems"):(m="listItems",l.filter=g.filter.concat())}else if(e.key.secondary&&g.filter.length==2){for(var q,o,r=0;r<g.filter.length;r++){n=g.filter[r];if(n.item==e.key.primary.name&&n.operator=="equals")q=n.value;n.item==e.key.secondary.name&&
(o=n)}q&&o?(m="queryItems",l.key={primary:q},l.filter=o):(m="listItems",l.filter=g.filter.concat())}else if(m="listItems",g.filter.length>0)l.filter=g.filter.concat();if(m=="queryItems"){if(g.limit>0)l.limit=g.limit;l.searchForward=g.searchForward}var s=!1,t=function(n){var q=n.items;g.limit>n.items.length&&n.stopKey?(l.startKey=n.stopKey,k[m](l,t,f)):s=!0;if(m!="queryItems"){var o=e.key.secondary?"secondary":"primary";e.key[o].dataType=="number"?g.searchForward?q.sort(function(a,b){return a[e.key[o].name]-
b[e.key[o].name]}):q.sort(function(a,b){return-1*(a[e.key[o].name]-b[e.key[o].name])}):g.searchForward?q.sort(function(a,b){return a[e.key[o].name].localeCompare(b[e.key[o].name])}):q.sort(function(a,b){return-1*a[e.key[o].name].localeCompare(b[e.key[o].name])});g.limit>0&&g.limit<q.length&&(q=q.slice(0,g.limit))}for(n=0;n<q.length;n++)(function(f){var g={primary:f[e.key.primary.name]};if(e.key.secondary)g.secondary=f[e.key.secondary.name];c&&c(new h.Storage.ItemSnapshot({key:g,table:a,credentials:d,
connection:b,value:f,operationManager:k}))})(q[n]);s&&c&&c(null)};k[m](l,t,f)},f)};this.getItems=function(a,b){l(a,b);return this};this.on=function(){var c,h,j,l;if(arguments.length==4)c=arguments[0],h=arguments[1],j=arguments[2],l=arguments[3];else if(arguments.length==3)c=arguments[0],typeof arguments[1]=="function"?(j=arguments[1],l=arguments[2]):(h=arguments[1],j=arguments[2]);else if(arguments.length==2)c=arguments[0],typeof arguments[1]=="function"?j=arguments[1]:h=arguments[1];else return typeof l==
"function"&&l("Invalid arguments. You must specify an event type and a success callback. The primary key is optional."),this;if(c!="put"&&c!="delete"&&c!="update")return typeof l=="function"&&l("Invalid event type. Possible values: put, delete and update"),this;if(h&&typeof h!="string")return typeof l=="function"&&l("Invalid primary key. It must be a string."),this;if(typeof j!="function")return typeof l=="function"&&l("Must specify a success function."),this;h?(m.subscribe(c,{primary:h},!1,j),c==
"put"&&this.meta(function(c){if(c.key.secondary){var f=n();(new e.TableRef({properties:f,credentials:d,connection:b,operationManager:k})).equals({item:c.key.primary.name,value:h}).getItems(function(a){j(a)},function(b){typeof l=="function"&&l(b);return a})}else a.item({primary:h}).get(function(a){j(a)},function(b){typeof l=="function"&&l(b);return a})})):this.meta(function(b){c=="put"&&a.getItems(function(a){j(a)},function(b){typeof l=="function"&&l(b);return a});for(var d=!1,e=0;e<g.filter.length&&
!d;e++)g.filter[e].item==b.key.primary.name&&g.filter[e].operator=="equals"&&(m.subscribe(c,{primary:g.filter[e].value},!1,j),d=!0);d||m.subscribe(c,f,!1,j)});return this};this.off=function(){var a,b,c,d;arguments.length==4?(a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3]):arguments.length==3?(a=arguments[0],typeof arguments[1]=="function"?(c=arguments[1],d=arguments[2]):(b=arguments[1],c=arguments[2])):arguments.length==2?(a=arguments[0],c=arguments[1]):arguments.length==1&&(a=arguments[0]);
a?a!="put"&&a!="delete"&&a!="update"?typeof d=="function"&&d("Invalid event type. Possible values: put, delete and update"):b?m.unsubscribe(a,{primary:b},c):this.meta(function(b){for(var d=!1,e=0;e<g.filter.length&&!d;e++)g.filter[e].item==b.key.primary.name&&g.filter[e].operator=="equals"&&(m.unsubscribe(a,{primary:g.filter[e].value},c),d=!0);d||m.unsubscribe(a,f,c)}):m.unsubscribe(f,f,f);return this};this.once=function(){var c,g,h,l;if(arguments.length==4)c=arguments[0],g=arguments[1],h=arguments[2],
l=arguments[3];else if(arguments.length==3)c=arguments[0],typeof arguments[1]=="function"?(h=arguments[1],l=arguments[2]):(g=arguments[1],h=arguments[2]);else if(arguments.length==2)c=arguments[0],typeof arguments[1]=="function"?h=arguments[1]:g=arguments[1];else return typeof l=="function"&&l("Invalid arguments. You must specify an event type and a success callback. The primary key is optional."),this;if(c!="put"&&c!="delete"&&c!="update")return typeof l=="function"&&l("Invalid event type. Possible values: put, delete and update"),
this;if(g&&typeof g!="string")return typeof l=="function"&&l("Invalid primary key. It must be a string."),this;if(typeof h!="function")return typeof l=="function"&&l("Must specify a success function."),this;g?(m.subscribe(c,{primary:g},!0,h),c=="put"&&this.meta(function(c){if(c.key.secondary){var f=n();(new e.TableRef({properties:f,credentials:d,connection:b,operationManager:k})).equals({item:c.key.primary.name,value:g}).getItems(function(a){h(a)},function(b){typeof l=="function"&&l(b);return a})}else a.item({primary:g}).get(function(a){h(a)},
function(b){typeof l=="function"&&l(b);return a})})):(m.subscribe(c,f,!0,h),c=="put"&&this.getItems(function(a){h(a)},function(b){typeof l=="function"&&l(b);return a}));return this};var o;k.describeTable({table:this.name()},function(b){o=b;a.fire({meta:o})},function(b){a.fire({error:{message:b}})})}})(window.Realtime.Storage=window.Realtime.Storage||{})})(window.Realtime=window.Realtime||{});
(function(h){(function(e){e.Credentials=function(f){this.applicationKey=f.applicationKey;this.authenticationToken=f.authenticationToken;this.isSecure=typeof f.isSecure=="boolean"?f.isSecure:!1;this.isCluster=typeof f.isCluster=="boolean"?f.isCluster:!0;var c;this.url=f.url?this.isCluster?f.url:c=f.url:this.isSecure?"https://storage-balancer.realtime.co/server/ssl/1.0":"http://storage-balancer.realtime.co/server/1.0";this.getURL=function(a,d){c?a(c):h.Request.get({url:this.url,crossDomain:!0,complete:function(b){b.url?
(c=b.url,a(c)):d&&(b.error.message?d("Could not retrieve the server url from the cluster. "+b.error.message):d("Could not retrieve the server url from the cluster."+b.error))}})};this.refreshURL=function(a,d){c=null;f.url&&!this.isCluster?a(f.url):this.getURL(a,d)}}})(window.Realtime.Storage=window.Realtime.Storage||{})})(window.Realtime=window.Realtime||{});
(function(h){(function(e,f){e.StorageRef=function(a){var c=this,b=this.credentials=new h.Storage.Credentials(a),e=new h.Storage.Operation(b),g=a.onReconnect,m=a.onReconnecting,n=this.connection=h.Messaging.ConnectionManager.create({url:b.isSecure?"https://ortc-storage.realtime.co/server/ssl/2.1/":"http://ortc-storage.realtime.co/server/2.1/",appKey:b.applicationKey,authToken:b.authenticationToken,connectAttempts:100,onReconnect:typeof g=="function"?function(){g.call(c,c)}:f,onReconnecting:typeof m==
"function"?function(){m.call(c,c)}:f});this.table=function(a){return!a?null:new h.Storage.TableRef({name:a,credentials:b,connection:n,operationManager:e})};this.isAuthenticated=function(a,b,c){if(typeof a!="string")return c&&c("No token to verify."),this;e.isAuthenticated({authenticationToken:a},b,c);return this};this.getTables=function(a,c){e.listTables({},function(c){if(a)for(var d=0;d<c.tables.length;d++)a(new h.Storage.TableSnapshot({name:c.tables[d],credentials:b,connection:n,operationManager:e}))},
c);return this}};var c=function(){var a=null;navigator.appName=="Microsoft Internet Explorer"&&/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)!=null&&(a=parseFloat(RegExp.$1));return a};e.create=function(a,d,b){a.applicationKey||b&&b("Cannot create a storage reference without specifying a valid application key.");a.authenticationToken||b&&b("Cannot create a storage reference without specifying an authenticated token.");var e=c();if(e&&e<10){var e=window.location.protocol,f="Cannot create a StorageRef with the specified arguments. ";
f+="In order to do cross-domain requests, the requesting page must be using the same protocol (http or https) as the server. ";f+="You are trying to do requests from "+e+" protocol to "+(a.isSecure?"https: protocol.":"http: protocol.");if(e=="file:"){b&&b(f);return}if(a.url){if(!a.url.match(e)){b&&b("The specified url does not match the page protocol. "+f);return}}else if(e!=(a.isSecure?"https:":"http:")){b&&b(f);return}}var m=new h.Storage.StorageRef(a);m.credentials.getURL(function(){d&&d(m)},function(a){b(a)})};
e.ProvisionType={Light:1,Medium:2,Intermediate:3,Heavy:4,Custom:5};e.ProvisionLoad={Read:1,Write:2,Balanced:3}})(window.Realtime.Storage=window.Realtime.Storage||{})})(window.Realtime=window.Realtime||{});
